<div *ngIf="recipe" class="recipe-details" #recipeRef>
  <div class="rec-header">
    <div class="rec-title">
      <h1>{{ recipe.name | title }}</h1>
      <div *ngIf="recipe.addedBy" class="added-cont hide-sm">
        <p>Added by {{ recipe.addedBy }}</p>
        <p *ngIf="recipe.created">{{ recipe.created | date }}</p>
      </div>
    </div>
    <hr />
  </div>

  <section>
    <div class="tags-ing-list">
      <div class="tags-list">
        <div *ngFor="let tag of recipe.tags" class="tag">{{ tag }}</div>
      </div>
      <mat-expansion-panel expanded="true" class="main-section-mep ingredients-expansion">
        <mat-expansion-panel-header>
          <mat-panel-title><h2 id="ingredients-title">Ingredients</h2></mat-panel-title>
        </mat-expansion-panel-header>
        <ul
          class="list-group"
          id="ingredient-list"
          [ngClass]="ingExpanded ? 'show' : 'hide'"
          *ngIf="recipe.ingredients?.length"
        >
          <li *ngFor="let ing of recipe.ingredients" class="list-group-item">
            {{ ing }}
          </li>
        </ul>
      </mat-expansion-panel>
    </div>

    <img [src]="recipe.imagePath" alt="{{ recipe.name }}" class="recipe-img" />
    <div class="recipe-actions">
      <div
        class="fav-lottie lottie-anim"
        [class.on]="isFavourite"
        [appLottie]="'heart-like'"
        [autoplay]="false"
        [startFrame]="isFavourite ? 110 : null"
        [play]="isFavourite ? [60, 110] : [140, 150]"
      >
        <div class="click-anchor" (click)="favourite()"></div>
      </div>

      <div
        class="todo-lottie lottie-anim"
        [class.on]="toDoSelected"
        [appLottie]="'to-do-green'"
        [autoplay]="false"
        [startFrame]="toDoSelected ? 20 : 0"
        [play]="toDoSelected ? [0, 22] : [22, 0]"
        [direction]="toDoSelected ? 'forward' : 'backward'"
      >
        <div class="click-anchor" (click)="toggleToDo()"></div>
      </div>
    </div>
    <mat-expansion-panel expanded="true" class="main-section-mep method-expansion">
      <mat-expansion-panel-header>
        <mat-panel-title><h2>Method</h2></mat-panel-title>
      </mat-expansion-panel-header>
      <div [innerHtml]="recipe.description" class="desc"></div>
    </mat-expansion-panel>
  </section>

  <div class="additional-details">
    <div class="notes-dates">
      <mat-accordion class="example-headers-align" multi>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              Notes
              <span *ngIf="notes.length" [style.margin-left.px]="3">({{ notes.length }})</span>
            </mat-panel-title>
            <mat-panel-description>
              <span class="material-icons">comment_bank</span>
            </mat-panel-description>
          </mat-expansion-panel-header>
          <app-notes
            [notes]="notes"
            [currentUserId]="readOnly ? null : user.id"
            (deleteEmitter)="onDeleteNote($event)"
            (saveEmitter)="onNoteSave($event)"
          ></app-notes>
        </mat-expansion-panel>

        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Dates</mat-panel-title>
            <mat-panel-description>
              <span class="material-icons">event</span>
            </mat-panel-description>
          </mat-expansion-panel-header>
          <div class="dates-container">
            <h6>{{ datesMade.length ? 'Add another date' : 'Have you made this recipe?' }}</h6>
            <div class="date-actions">
              <button class="btn btn-primary today" (click)="onDateChange()">
                <span>Today</span>
                <img src="assets/images/today.png" />
              </button>
              <button class="btn btn-primary date-select" (click)="picker.open()">
                <span>Select</span>
                <img src="assets/images/tomorrow.png" />
                <input
                  class="hidden"
                  id="dateMade"
                  [matDatepicker]="picker"
                  [(ngModel)]="dateInput"
                  (ngModelChange)="onDateChange($event)"
                />
                <mat-datepicker #picker></mat-datepicker>
              </button>
            </div>
            <div *ngIf="datesMade.length" class="dates-list">
              <h6>You made this recipe on...</h6>
              <div>
                <p class="date-item" *ngFor="let d of datesMade">
                  <span>{{ d.date | date }}</span>
                  <span
                    (click)="deleteDate(d)"
                    class="material-icons remove"
                    matTooltip="remove this date"
                    matTooltipShowDelay="500"
                  >
                    clear
                  </span>
                </p>
              </div>
            </div>
          </div>
        </mat-expansion-panel>

        <mat-expansion-panel expanded>
          <mat-expansion-panel-header>
            <mat-panel-title>Nutrition</mat-panel-title>
            <mat-panel-description>
              <span class="material-icons">spa</span>
            </mat-panel-description>
          </mat-expansion-panel-header>
          <div class="nutrition">
            <app-nutrition-table [nutritionValues]="recipe.nutrition"></app-nutrition-table>
          </div>
        </mat-expansion-panel>
      </mat-accordion>
    </div>
  </div>
</div>

<div class="actions" *ngIf="showEdit && !readOnly">
  <button *ngIf="showDelete" type="button" (click)="deleteRecipe()" class="btn btn-danger">Delete</button>
  <button type="button" (click)="editRecipe()" class="btn btn-primary">Edit</button>
</div>
